var touchJS=jQuery.noConflict();var WPtouchWebApp=window.navigator.standalone;var addToHomeConfig={animationIn:"bubble",animationOut:"bubble",startDelay:800,lifespan:1000*60,expire:60*24*30,bottomOffset:12,touchIcon:true,arrow:true,message:WPtouch.add2home_message};if(top.location!=self.location){top.location=self.location.href}function doClassicReady(){touchJS(function(){var e=touchJS("#menu-container > div");touchJS("#tab-inner-wrap-left a").click(function(){e.hide().filter(this.hash).show();touchJS("#tab-inner-wrap-left a").removeClass("selected");touchJS(this).addClass("selected");return false}).filter(":first").click()});touchJS("a#header-menu-toggle").click(function(){touchJS("#main-menu").opacityToggle(380);touchJS(this).toggleClass("menu-toggle-open");return false});touchJS("#main-menu ul li a:not(li.has_children > a)").click(function(){touchJS(this).parent().addClass("active")});touchJS("a#tab-search").click(function(){touchJS("#search-bar").toggleClass("show-search");touchJS(this).toggleClass("search-toggle-open");return false});touchJS("#main-menu").find("li.has_children ul").hide();touchJS("#main-menu ul li.has_children > a").click(function(){touchJS(this).parent().children("ul").opacityToggle(380);touchJS(this).toggleClass("arrow-toggle");touchJS(this).parent().toggleClass("open-tree");return false});if(touchJS("#prowl-message").length){setTimeout(function(){touchJS("#prowl-message").fadeOut(350)},2500)}if(touchJS(".single, .page").length){touchJS(".content img, .content .wp-caption").each(function(){if(touchJS(this).width()<=250&&touchJS(this).width()>100){touchJS(this).addClass("aligncenter")}})}touchJS(".single .p3-img-protect").each(function(){touchJS(".p3-overlay").remove();var e=touchJS(this).html();touchJS(this).replaceWith(e)});touchJS("a#share-post").click(function(){touchJS("#share-absolute").opacityToggle(380).viewportCenter();return false});touchJS("a#share-close").click(function(){touchJS("#inner-ajax #share-absolute").opacityToggle(380);return false});touchJS("li#instapaper a").click(function(){var f=prompt(WPtouch.instapaper_username,"");if(f){var e=prompt(WPtouch.instapaper_password,"");if(!e){e="default"}var g={url:document.location.href,username:f,password:e,title:document.title};WPtouchAjax("instapaper",g,function(h){if(h=="1"){alert(WPtouch.instapaper_saved);touchJS("a#share-close").click()}else{alert(WPtouch.instapaper_try_again);touchJS("li#instapaper a").click()}})}return false});var a=touchJS("#share-absolute").get(0);if(a){var d=touchJS(window).height()+100+"px";a.addEventListener("touchmove",classicTouchMove,false);touchJS("#email a").click(function(){touchJS("a#share-close").click();return true});touchJS("#share-absolute").css("height",d)}touchJS(".commentlist li :first, .commentlist img.avatar:first").addClass("first");touchJS("a.com-toggle").bind("click",function(){touchJS("ol.commentlist").toggleClass("hidden");touchJS("img#com-arrow").toggleClass("com-arrow-down");return false});if(touchJS(window).width()>=480){touchJS("body").addClass("landscape")}else{touchJS("body").addClass("portrait")}window.onorientationchange=function(){var e=window.orientation;switch(e){case 0:case 180:touchJS("body").addClass("portrait").removeClass("landscape");break;case 90:case -90:touchJS("body").addClass("landscape").removeClass("portrait");break;default:touchJS("body").addClass("portrait").removeClass("landscape")}};var c=document.location;var b={beforeSubmit:function(){touchJS("#commentform textarea").addClass("loading")},success:function(){touchJS("#commentform textarea").removeClass("loading").addClass("success");alert(WPtouch.comment_success);setTimeout(function(){touchJS("#commentform textarea").removeClass("success")},1500)},error:function(){touchJS("#commentform textarea").removeClass("loading").addClass("error");alert(WPtouch.comment_failure);setTimeout(function(){touchJS("#commentform textarea").removeClass("error")},3000)},resetForm:true,timeout:10000};if(touchJS.isFunction(jQuery.fn.ajaxForm)){touchJS("#commentform").ajaxForm(b)}loadMoreEntries();loadMoreComments();comReplyArrows();classicExcerptToggle();welcomeMessage();webAppLinks();webAppOnly();touchJS("a.login-req, a.comment-reply-login").bind("click",function(){touchJS("a#header-menu-toggle, a#tab-login").click();scrollTo(0,0,1);return false});if(!touchJS(".single").length){touchJS(window).load(function(){setTimeout(scrollTo,0,0,1)})}touchJS("a.back-to-top").click(function(){scrollTo(0,0,100);return false});jQuery(function(){var e=1;jQuery("input, select, textarea").each(function(){if(this.type!="hidden"){var f=jQuery(this);f.attr("tabindex",e);e++}})})}touchJS.fn.opacityToggle=function(a,c,b){return this.animate({opacity:"toggle"},a,c,b)};touchJS.fn.viewportCenter=function(){this.hide().css("position","absolute");this.css("top",(touchJS(window).height()-this.height())/3+touchJS(window).scrollTop()+"px");this.css("left",(touchJS(window).width()-this.width())/2+touchJS(window).scrollLeft()+"px");this.show();return this};function classicTouchMove(a){a.preventDefault()}function welcomeMessage(){if(!WPtouchWebApp){touchJS("#welcome-message").show();touchJS("a#close-msg").bind("click",function(){WPtouchCreateCookie("wptouch_welcome","1",365);touchJS("#welcome-message").fadeOut(350);return false})}}function webAppLinks(){if(WPtouchWebApp){var a=touchJS("a").not(".no-ajax, .email a, .feed a, a#header-menu-toggle, .has_children > a, a.load-more-link, .load-more-comments-link a, a#share-post, a#share-close");a.each(function(){var d=touchJS(this).attr("href");var c=touchJS(this);var b=location.hostname;if(typeof wptouch_ignored_urls!="undefined"){touchJS.each(wptouch_ignored_urls,function(e,f){if(d.match(f)){c.addClass("ignored")}})}if(d.match((/[^\s]+(\.(pdf|numbers|pages|xls|xlsx|doc|docx|zip|tar|gz|csv|txt))$/i))){c.addClass("external")}else{if(d.match((/[^\s]+(\.(jpg|jpeg|gif|png|bmp|tiff))$/i))){c.addClass("img-link")}}touchJS(c).unbind("click").bind("click",function(f){if(touchJS(c).hasClass("external")||touchJS(c).parent("li").hasClass("external")){confirmForExternal=confirm(WPtouch.external_link_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}else{if(touchJS(c).hasClass("img-link")){return false}else{if(d.match(b)||!d.match("http://")){if(touchJS(c).hasClass("ignored")||touchJS(c).parent("li").hasClass("ignored")){confirmForExternal=confirm(WPtouch.wptouch_ignored_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}else{if(touchJS("#main-menu").hasClass("show-menu")){touchJS(this).opacityToggle(380);touchJS("a#header-menu-toggle").toggleClass("menu-toggle-open")}loadPage(d);return false}}else{confirmForExternal=confirm(WPtouch.external_link_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}}}})})}}function loadPage(b){var a=touchJS("body.loadsaved").length;if(touchJS("body.ajax-on").length){touchJS("body").append('<div id="progress"></div>');touchJS("#progress").viewportCenter();touchJS(document).unbind();touchJS("#outer-ajax").load(b+" #inner-ajax",function(c){touchJS("#progress").addClass("done");if(a){WPtouchCreateCookie("wptouch-load-last-url",b,365)}else{WPtouchEraseCookie("wptouch-load-last-url")}doClassicReady();scrollTo(0,0)})}else{touchJS("body").append('<div id="progress"></div>');touchJS("#progress").viewportCenter();if(a){WPtouchCreateCookie("wptouch-load-last-url",b,365)}setTimeout(function(){window.location=b},550)}}function webAppOnly(){if(WPtouchWebApp){var a=touchJS("body.loadsaved").length;if(!a){WPtouchEraseCookie("wptouch-load-last-url")}touchJS("body").addClass("web-app");touchJS("body.black-translucent").css("margin-top","20px");touchJS("#switch, a.comment-reply-link, a.comment-edit-link, #welcome-message").remove();setTimeout(function(){touchJS("#progress").remove()},150)}}function classicExcerptToggle(){touchJS("a.excerpt-button").live("click",function(){touchJS(this).toggleClass("open").parent(".post").find(".content").opacityToggle(380);return false})}function loadMoreEntries(){var a=touchJS("a.load-more-link");var b=".ajax-page-target";a.live("click",function(){touchJS(this).addClass("ajax-spinner").text(WPtouch.loading_text);var c=touchJS(this).attr("rel");touchJS("#content").append("<div class='ajax-page-target'></div>");touchJS(b).hide().load(c+" #content .post, #content .load-more-link",function(){touchJS(this).replaceWith(touchJS(this).html());touchJS("a.load-more-link.ajax-spinner").fadeOut(350);webAppLinks()});return false})}function loadMoreComments(){var a=touchJS("li.load-more-comments-link a");var b=".ajax-page-target";a.live("click",function(){touchJS(this).addClass("ajax-spinner");var c=touchJS(this).attr("href");touchJS("ol.commentlist").append("<div class='ajax-page-target'></div>");touchJS(b).hide().load(c+" ol.commentlist > li",function(){touchJS(this).replaceWith(touchJS(this).html());touchJS(".load-more-comments-link a.ajax-spinner").parent().fadeOut(350);if(WPtouchWebApp){touchJS("a.comment-reply-link, a.comment-edit-link").remove();webAppLinks()}});return false})}function comReplyArrows(){var a=touchJS("ol.commentlist li li > .comment-top");touchJS.each(a,function(){touchJS(a).prepend("<div class='com-down-arrow'></div>")})}function WPtouchCreateCookie(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path="+WPtouch.siteurl}function WPtouchEraseCookie(a){WPtouchCreateCookie(a,"",-1)}touchJS(document).ready(function(){doClassicReady()});